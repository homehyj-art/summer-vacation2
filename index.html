<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ì—¬ë¦„ ë°©í•™ ë‚˜ì˜ ì¶”ì–µ</title>

  <!-- ê·€ì—¬ìš´ í•œê¸€ í°íŠ¸ -->
  <link href="https://fonts.googleapis.com/css2?family=Jua&display=swap" rel="stylesheet">

  <style>
    :root{
      --pink:#ff8aa1;
      --pink-dark:#ff6b86;
      --bg-mint:#d8f8f0;
    }
    *{box-sizing:border-box}
    body{
      font-family:'Jua', sans-serif;
      margin:0;
      background-color:var(--bg-mint);
      /* ìˆ˜ë°• íƒ€ì¼ ì—¬ëŸ¬ ê°œ ë°˜ë³µ */
      background-image:
        url('https://cdn.pixabay.com/photo/2017/01/31/21/23/watermelon-2023401_1280.png');
      background-size:140px;
      background-repeat:repeat;
    }
    header{
      text-align:center;
      padding:22px 12px;
      color:#fff;
      background: linear-gradient(90deg, var(--pink), var(--pink-dark));
      border-bottom:4px solid #ff5577;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.08);
      font-size:clamp(22px,4vw,34px);
    }
    .container{
      max-width:1100px;
      margin:22px auto;
      padding:18px;
      background:rgba(255,255,255,0.9);
      border-radius:18px;
      box-shadow:0 8px 24px rgba(0,0,0,0.08);
    }

    /* ê°€ì‚¬ ì¹´ë“œ */
    .lyrics-wrap{
      display:flex;
      flex-wrap:wrap;
      gap:18px;
    }
    .song{
      flex:1 1 420px;
      background:#fffdf5;
      border:3px solid #ffe0e6;
      border-radius:16px;
      padding:16px 16px 4px;
      box-shadow:0 6px 14px rgba(0,0,0,0.06);
    }
    .song h2{
      margin:0 0 8px;
      text-align:center;
      color:#ff5e7a;
      letter-spacing:0.5px;
    }
    .lyrics-text{
      white-space:pre-wrap;  /* ì¤„ë°”ê¿ˆ ê·¸ëŒ€ë¡œ í‘œì‹œ */
      line-height:1.85;
      margin:10px 0 6px;
    }

    /* ëŒ“ê¸€ ì„¹ì…˜ */
    .comment-section{
      margin-top:26px;
      background:#ffffff;
      border:3px solid #c8fff1;
      border-radius:16px;
      padding:16px;
      box-shadow:0 6px 14px rgba(0,0,0,0.05);
    }
    .comment-section h3{
      margin:0 0 12px;
      color:#14b8a6;
      text-align:center;
    }
    .comment-input{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom:10px;
    }
    .comment-input input,
    .comment-input textarea{
      flex:1 1 220px;
      padding:10px 12px;
      border:2px solid #ffd4dc;
      border-radius:10px;
      font-family:'Jua', sans-serif;
      font-size:16px;
      background:#fffdfd;
    }
    .comment-input textarea{min-height:84px}
    .btn{
      border:none;
      cursor:pointer;
      border-radius:10px;
      padding:10px 14px;
      font-family:'Jua', sans-serif;
      font-size:16px;
      transition:transform .05s ease;
    }
    .btn:active{transform:translateY(1px)}
    .btn-primary{background:var(--pink); color:#fff;}
    .btn-primary:hover{background:var(--pink-dark)}
    .comment-list{list-style:none; margin:0; padding:0}
    .comment-item{
      background:#fff9fb;
      border:2px solid #ffe2ea;
      border-radius:12px;
      padding:12px;
      margin-bottom:10px;
    }
    .meta{
      color:#ff6b86;
      margin-bottom:6px;
    }
    .comment-actions{
      margin-top:8px;
      display:flex;
      align-items:center;
      gap:16px;               /* ğŸ‘ ë²„íŠ¼ê³¼ ì‚­ì œ ë²„íŠ¼ ì‚¬ì´ ê°„ê²© */
      flex-wrap:wrap;
    }
    .like-btn, .delete-btn{
      background:#fff;
      border:2px solid #ffd4dc;
      padding:6px 12px;
      border-radius:10px;
      font-size:16px;
    }
    .like-btn{color:#ff5073}
    .delete-btn{color:#64748b}
    .like-btn:hover{border-color:#ffb4c2}
    .delete-btn:hover{border-color:#94a3b8}
  </style>
</head>
<body>

<header>ğŸŒ´ ì—¬ë¦„ ë°©í•™ ë‚˜ì˜ ì¶”ì–µ â€” ë…¸ë˜ & ëŒ“ê¸€ ğŸ‰</header>

<div class="container">
  <!-- ê°€ì‚¬ ì˜ì—­ -->
  <section class="lyrics-wrap">
    <article class="song">
      <h2>ì—¬í–‰ì„ ë– ë‚˜ìš” â€” ì´ìŠ¹ê¸°</h2>
      <div class="lyrics-text" id="lyricsTravel">
        <!-- âœ… ì—¬ê¸° ì´ìŠ¹ê¸° ã€Œì—¬í–‰ì„ ë– ë‚˜ìš”ã€ì˜ ê³µì‹ ê°€ì‚¬ë¥¼ ë¶™ì—¬ ë„£ìœ¼ì„¸ìš”. -->
        <!-- ì˜ˆì‹œ ìë¦¬í‘œì‹œì (ë¶™ì—¬ë„£ì€ ë’¤ ì‚­ì œí•´ë„ ë¨) -->
í‘¸ë¥¸ ì–¸ë•ì— ë°°ë‚­ì„ ë©”ê³ 
í™©ê¸ˆë¹› íƒœì–‘ ì¶•ì œë¥¼ ì—¬ëŠ”
ê´‘ì•¼ë¥¼ í–¥í•´ì„œ ê³„ê³¡ì„ í–¥í•´ì„œ
ë¨¼ ë™ì´ íŠ¸ëŠ” ì´ë¥¸ ì•„ì¹¨ì—
ë„ì‹œì˜ ì†ŒìŒ ìˆ˜ ë§ì€ ì‚¬ëŒ
ë¹Œë”© ìˆ²ì†ì„ ë²—ì–´ë‚˜ë´ìš”

ë©”ì•„ë¦¬ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¤ëŠ”
ê³„ê³¡ì†ì˜ íë¥´ëŠ” ë¬¼ì°¾ì•„
ê·¸ê³³ìœ¼ë¡œ ì—¬í–‰ì„ ë– ë‚˜ìš” x 2

êµ½ì´ ë˜ êµ½ì´ ê¹Šì€ ì‚°ì¤‘ì—
ì‹œì›í•œ ë°”ëŒ ë‚˜ë¥¼ ë°˜ê¸°ë„¤
í•˜ëŠ˜ì„ ë³´ë©° ë…¸ë˜ ë¶€ë¥´ì„¸

ë©”ì•„ë¦¬ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¤ëŠ”
ê³„ê³¡ì†ì˜ íë¥´ëŠ” ë¬¼ì°¾ì•„
ê·¸ê³³ìœ¼ë¡œ ì—¬í–‰ì„ ë– ë‚˜ìš” x 2

êµ½ì´ ë˜ êµ½ì´ ê¹Šì€ ì‚°ì¤‘ì—
ì‹œì›í•œ ë°”ëŒ ë‚˜ë¥¼ ë°˜ê¸°ë„¤
í•˜ëŠ˜ì„ ë³´ë©° ë…¸ë˜ ë¶€ë¥´ì„¸

ë©”ì•„ë¦¬ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¤ëŠ”
ê³„ê³¡ì†ì˜ íë¥´ëŠ” ë¬¼ì°¾ì•„
ê·¸ê³³ìœ¼ë¡œ ì—¬í–‰ì„ ë– ë‚˜ìš” x 2

ì—¬í–‰ì„ ë– ë‚˜ìš”
ì¦ê±°ìš´ ë§ˆìŒìœ¼ë¡œ
ëª¨ë‘ í•¨ê»˜ ë– ë‚˜ìš” x 2
ì•„-

ë©”ì•„ë¦¬ ì†Œë¦¬ê°€ ë“¤ë ¤ì˜¤ëŠ”
ê³„ê³¡ì†ì˜ íë¥´ëŠ” ë¬¼ì°¾ì•„
ê·¸ê³³ìœ¼ë¡œ ì—¬í–‰ì„ ë– ë‚˜ìš” x 3
      </div>
    </article>

    <article class="song">
      <h2>ë‹¤ì‹œ ì—¬ê¸° ë°”ë‹·ê°€ â€” ì‹¹ì“°ë¦¬(SSAK3)</h2>
      <div class="lyrics-text" id="lyricsBeach">
        <!-- âœ… ì—¬ê¸° ì‹¹ì“°ë¦¬ ã€Œë‹¤ì‹œ ì—¬ê¸° ë°”ë‹·ê°€ã€ì˜ ê³µì‹ ê°€ì‚¬ë¥¼ ë¶™ì—¬ ë„£ìœ¼ì„¸ìš”. -->
        <!-- ì˜ˆì‹œ ìë¦¬í‘œì‹œì (ë¶™ì—¬ë„£ì€ ë’¤ ì‚­ì œí•´ë„ ë¨) -->
ì˜ˆì•„! í˜¸ìš°! ì˜ˆì˜ˆì˜ˆ
ì‹¹ì“°ë¦¬ ì¸ë” í•˜ìš°ìŠ¤
ì»¤ì»¤ì»¤ì»¤ì»¤ëª¬! ì‹¹!ì“°ë¦¬!íˆ¬ ë ›ì¸ ê³ !

ë‚˜ ë‹¤ì‹œ ë˜ ì„¤ë ˆì–´
ì´ë ‡ê²Œ ë„ˆë¥¼ ë§Œë‚˜ì„œ
í•¨ê»˜ í•˜ê³  ìˆëŠ” ì§€ê¸ˆ ì´ ê³µê¸°ê°€

ë‹¤ì‹œëŠ” ë„ ë³¼ ìˆœ ì—†ì„ ê±°ë¼ê³ 
ì¶”ì–µì¼ ë¿ì´ë¼
ì„œë ì†ì— ê¼­ ë„£ì–´ë’€ëŠ”ë°

íë¥´ëŠ” ì‹œê°„ ì†ì—ì„œ
ë„ˆì™€ ë‚´ ê¸°ì–µì€
ì ì  í¬ë¯¸í•´ì ¸ë§Œ ê°€
ëë‚œ ì¤„ ì•Œì•˜ì–´

ì§€ë‚œì—¬ë¦„ ë°”ë‹·ê°€
ë„ˆì™€ ë‚˜ ë‹¨ë‘˜ì´
íŒŒë„ì— ì·¨í•´ì„œ ë…¸ë˜í•˜ë©°
ê°™ì€ ê¿ˆì„ ê¾¸ì—ˆì§€
ë‹¤ì‹œ ì—¬ê¸° ë°”ë‹·ê°€
ì´ì œëŠ” ë§í•˜ê³  ì‹¶ì–´
ë„¤ê°€ ìˆì—ˆê¸°ì— ë‚´ê°€ ë”ìš± ë¹›ë‚˜
ë³„ì´ ë˜ì—ˆë‹¤ê³ 

ë‹¤ë“¤ ë¥ë‹¤ê³  ë§‰ ì§œì¦ë‚´
ê´œì°®ì•„ ìš°ë¦¬ ë‘˜ì€ ë”°ëœ»í•´
ë‚´ê²Œ íë‹¹ ë¹ ì ¸ë²„ë¦° ë„
ì´ì   êµ¬í•˜ëŸ¬ ê°€ì§€ ì•Šì„ ê±°ì•¼
ëª¨ë˜ ìœ„ í´í´í´í¸ì§€ë¥¼ ì¨
ë°€ë¬¼ì´ ë°€ë ¤ì™€ë„ ëª» ì§€ì›Œ
ì¶”ì–µì´ ë  ë»”í•œ ì²« ëŠë‚Œ
ë„ˆë‘ ë‹¤ì‹œ í•œë²ˆ ë°›ì•„ ë³´ê³  ì‹¶ì–´

íë¥´ëŠ” ì‹œê°„ ì†ì—ì„œ
ë„ˆì™€ ë‚´ ê¸°ì–µì€
ì ì  í¬ë¯¸í•´ì ¸ë§Œ ê°€
ëë‚œ ì¤„ ì•Œì•˜ì–´

ì§€ë‚œì—¬ë¦„ ë°”ë‹·ê°€
ë„ˆì™€ ë‚˜ ë‹¨ë‘˜ì´
íŒŒë„ì— ì·¨í•´ì„œ ë…¸ë˜í•˜ë©°
ê°™ì€ ê¿ˆì„ ê¾¸ì—ˆì§€
ë‹¤ì‹œ ì—¬ê¸° ë°”ë‹·ê°€
ì´ì œëŠ” ë§í•˜ê³  ì‹¶ì–´
ë„¤ê°€ ìˆì—ˆê¸°ì— ë‚´ê°€ ë”ìš± ë¹›ë‚˜
ë³„ì´ ë˜ì—ˆë‹¤ê³ 

ì‹œê°„ì˜ ê°•ì„ ê±´ë„ˆ
ë˜ ë§ë‹¿ì€ ë„ˆì™€ ë‚˜
ì†Œì¤‘í•œ ì‚¬ë‘ì„ ì˜ì›íˆ
ê°„ì§í•´ì¤˜

ì§€ë‚œì—¬ë¦„ ë°”ë‹·ê°€
ë„ˆì™€ ë‚˜ ë‹¨ë‘˜ì´
íŒŒë„ì— ì·¨í•´ì„œ ë…¸ë˜í•˜ë©°
ê°™ì€ ê¿ˆì„ ê¾¸ì—ˆì§€
ë‹¤ì‹œ ì—¬ê¸° ë°”ë‹·ê°€
ì´ì œëŠ” ë§í•˜ê³  ì‹¶ì–´
ë„¤ê°€ ìˆì—ˆê¸°ì— ë‚´ê°€ ë”ìš± ë¹›ë‚˜
ë³„ì´ ë˜ì—ˆë‹¤ê³ 
      </div>
    </article>
  </section>

  <!-- ëŒ“ê¸€ ì˜ì—­ -->
  <section class="comment-section">
    <h3>ğŸ’¬ ì¶”ì–µ ê³µìœ  ê²Œì‹œíŒ</h3>
    <div class="comment-input">
      <input type="text" id="nameInput" placeholder="ì´ë¦„(ì‚­ì œÂ·ì¢‹ì•„ìš” í™•ì¸ìš©)">
      <textarea id="commentInput" placeholder="ì—¬ë¦„ ë°©í•™ì— ê²ªì€ ê²½í—˜ì„ ì‘ì„±í•˜ì„¸ìš”..."></textarea>
      <button class="btn btn-primary" id="addCommentBtn">ë“±ë¡</button>
    </div>
    <ul class="comment-list" id="commentList"></ul>
  </section>
</div>

<!-- Firebase & App -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, set, onValue, update, remove, get } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCtBTzq6aIgRzWDB2gfG2LBK19Y4TYCj4w",
    authDomain: "summer-memory-bc163.firebaseapp.com",
    databaseURL: "https://summer-memory-bc163-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "summer-memory-bc163",
    storageBucket: "summer-memory-bc163.firebasestorage.app",
    messagingSenderId: "1014179818008",
    appId: "1:1014179818008:web:4570325a33a90582d2b16d"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ê°„ë‹¨í•œ ì‚¬ìš©ì ì‹ë³„: ì´ë¦„ + ê¸°ê¸°ë³„ ê³ ìœ  ID(ë¡œì»¬ìŠ¤í† ë¦¬ì§€)
  const USER_ID_KEY = "summerAppUserId";
  function ensureUserId(){
    let id = localStorage.getItem(USER_ID_KEY);
    if(!id){
      id = 'u-' + Math.random().toString(36).slice(2) + Date.now().toString(36);
      localStorage.setItem(USER_ID_KEY, id);
    }
    return id;
  }
  const userId = ensureUserId();

  const nameInput   = document.getElementById("nameInput");
  const commentInput= document.getElementById("commentInput");
  const addBtn      = document.getElementById("addCommentBtn");
  const listEl      = document.getElementById("commentList");

  let currentUserName = "";

  addBtn.addEventListener("click", () => {
    const name = nameInput.value.trim();
    const comment = commentInput.value.trim();
    if(!name || !comment){
      alert("ì´ë¦„ê³¼ ëŒ“ê¸€ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }
    currentUserName = name;

    const newRef = push(ref(db, "comments"));
    set(newRef, {
      name,
      author: name,
      comment,
      likes: 0,
      likedByNames: {},   // { [name]: true }
      likedByIds: {},     // { [userId]: true }
      timestamp: Date.now()
    });

    commentInput.value = "";
  });

  // ì¢‹ì•„ìš”(í•œ ì‚¬ëŒë‹¹ 1íšŒ) & ì‚­ì œ(ì‘ì„±ìë§Œ)
  function likeComment(id){
    if(!currentUserName && !nameInput.value.trim()){
      alert("ë¨¼ì € ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }
    if(!currentUserName) currentUserName = nameInput.value.trim();

    get(ref(db, "comments/"+id)).then(snap=>{
      if(!snap.exists()) return;
      const c = snap.val();
      const likedByNames = c.likedByNames || {};
      const likedByIds   = c.likedByIds   || {};

      if(likedByNames[currentUserName] || likedByIds[userId]){
        alert("ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì…¨ìŠµë‹ˆë‹¤!");
        return;
      }

      likedByNames[currentUserName] = true;
      likedByIds[userId] = true;

      update(ref(db, "comments/"+id), {
        likes: (c.likes||0)+1,
        likedByNames,
        likedByIds
      });
    });
  }

  function deleteComment(id){
    if(!currentUserName && !nameInput.value.trim()){
      alert("ë¨¼ì € ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”.");
      return;
    }
    if(!currentUserName) currentUserName = nameInput.value.trim();

    get(ref(db, "comments/"+id)).then(snap=>{
      if(!snap.exists()) return;
      const c = snap.val();
      if(c.author !== currentUserName){
        alert("ì‘ì„±ìë§Œ ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
        return;
      }
      if(confirm("ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
        remove(ref(db, "comments/"+id));
      }
    });
  }

  // ì‹¤ì‹œê°„ ëª©ë¡
  onValue(ref(db, "comments"), (snapshot)=>{
    listEl.innerHTML = "";
    const data = snapshot.val() || {};
    // ì‹œê°„ìˆœ ì •ë ¬
    const rows = Object.entries(data).sort((a,b)=> (a[1].timestamp||0) - (b[1].timestamp||0));
    for(const [id, item] of rows){
      const li = document.createElement("li");
      li.className = "comment-item";
      li.innerHTML = `
        <div class="meta"><strong>${item.name}</strong></div>
        <div>${item.comment}</div>
        <div class="comment-actions">
          <button class="like-btn" data-id="${id}" title="ì¢‹ì•„ìš”">ğŸ‘ ${item.likes || 0}</button>
          <button class="delete-btn" data-id="${id}" title="ì‚­ì œ">ì‚­ì œ</button>
        </div>
      `;
      // ì´ë²¤íŠ¸ ì—°ê²°
      li.querySelector(".like-btn").addEventListener("click", ()=> likeComment(id));
      li.querySelector(".delete-btn").addEventListener("click", ()=> deleteComment(id));
      listEl.appendChild(li);
    }
  });
</script>
</body>
</html>

